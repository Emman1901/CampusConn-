<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Campus Map</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="centerOnUser()" [disabled]="!userLocation">
        <ion-icon slot="icon-only" name="locate"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- Location Status Bar -->
  <div class="location-status" [class.active]="isTracking">
    <ion-icon [name]="isTracking ? 'radio-button-on' : 'radio-button-off'"></ion-icon>
    <span>{{ locationStatus }}</span>
  </div>

  <!-- Map Container -->
  <div #mapElement class="map-container"></div>

  <!-- Campus Locations Panel (Collapsible) -->
  <div class="locations-panel" [class.expanded]="isPanelExpanded">
    <div class="panel-header" (click)="togglePanel()">
      <h3>Campus Locations</h3>
      <ion-icon [name]="isPanelExpanded ? 'chevron-down' : 'chevron-up'"></ion-icon>
    </div>
    
    <div class="panel-content">
      <ion-list lines="none">
        <ion-item 
          *ngFor="let location of campusLocations" 
          button 
          (click)="navigateToLocation(location)"
          class="location-item"
        >
          <ion-icon [name]="location.icon" slot="start" [color]="location.color"></ion-icon>
          <ion-label>
            <h3>{{ location.name }}</h3>
            <p>{{ location.description }}</p>
          </ion-label>
          <ion-icon name="navigate-outline" slot="end"></ion-icon>
        </ion-item>
      </ion-list>
    </div>
  </div>

  <!-- User Location Info Card -->
  <ion-card class="user-location-card" *ngIf="userLocation">
    <ion-card-content>
      <div class="location-info">
        <ion-icon name="location" color="primary"></ion-icon>
        <div class="info-text">
          <h4>Your Location</h4>
          <p>Lat: {{ userLocation.lat.toFixed(6) }}</p>
          <p>Lng: {{ userLocation.lng.toFixed(6) }}</p>
          <p class="accuracy" *ngIf="locationAccuracy">
            Accuracy: Â±{{ locationAccuracy.toFixed(0) }}m
          </p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoadingMap">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Loading map...</p>
  </div>

  <!-- Error Message -->
  <ion-card class="error-card" *ngIf="errorMessage">
    <ion-card-content>
      <ion-icon name="warning" color="danger"></ion-icon>
      <p>{{ errorMessage }}</p>
      <ion-button expand="block" size="small" (click)="retryLocation()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Retry
      </ion-button>
    </ion-card-content>
  </ion-card>

</ion-content>